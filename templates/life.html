{% extends "base.html" %}

{% block body_tag %}
    <body class="life">
{% endblock %}

{% block main %}
    <div class="container" id="title-wrapper">
        <div class="inner-container m-t-lg">
            <h1>{{ item.title }}</h1>
        </div>
    </div>

    <div id="article-bar-wrapper">
        <div id="article-bar">
            <ul role="tablist">
                <li role="presentation" class="active">
                    <a href="#article" role="tab" data-toggle="tab">article</a>
                </li>
                <li role="presentation">
                    <a href="#gallery" role="tab" data-toggle="tab">gallery</a>
                </li>
                <li role="presentation">
                    <a href="#map" role="tab" data-toggle="tab">map</a>
                </li>
            </ul>
        </div>
    </div>

    <div id="article-wrapper">
        {{ item.output }}
        <div class="row hidden">
            <div class="col-md-9">
                {{ item.output }}
            </div>
            <div class="col-md-3">
                <div class="m-y">
                    <div class="media" id="demo-photo">
                        <span class="media-left media-middle" href="#">
                            <img alt="..." src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+PGRlZnMvPjxyZWN0IHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgZmlsbD0iI0VFRUVFRSIvPjxnPjx0ZXh0IHg9IjEzLjQ2ODc1IiB5PSIzMiIgc3R5bGU9ImZpbGw6I0FBQUFBQTtmb250LXdlaWdodDpib2xkO2ZvbnQtZmFtaWx5OkFyaWFsLCBIZWx2ZXRpY2EsIE9wZW4gU2Fucywgc2Fucy1zZXJpZiwgbW9ub3NwYWNlO2ZvbnQtc2l6ZToxMHB0O2RvbWluYW50LWJhc2VsaW5lOmNlbnRyYWwiPjY0eDY0PC90ZXh0PjwvZz48L3N2Zz4=">
                        </span>
                        <div class="media-body">
                            <p class="media-heading">Middle aligned media</p>
                            ...
                        </div>
                    </div>

                    <div class="media" id="demo-photo">
                        <span class="media-left media-middle" href="#">
                            <img alt="..." src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+PGRlZnMvPjxyZWN0IHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgZmlsbD0iI0VFRUVFRSIvPjxnPjx0ZXh0IHg9IjEzLjQ2ODc1IiB5PSIzMiIgc3R5bGU9ImZpbGw6I0FBQUFBQTtmb250LXdlaWdodDpib2xkO2ZvbnQtZmFtaWx5OkFyaWFsLCBIZWx2ZXRpY2EsIE9wZW4gU2Fucywgc2Fucy1zZXJpZiwgbW9ub3NwYWNlO2ZvbnQtc2l6ZToxMHB0O2RvbWluYW50LWJhc2VsaW5lOmNlbnRyYWwiPjY0eDY0PC90ZXh0PjwvZz48L3N2Zz4=">
                        </span>
                        <div class="media-body">
                            <p class="media-heading">Middle aligned media</p>
                            ...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=CAc10b3a8d557c49bc2ffd46a7f2805a"></script>
    <script>
        $(document).ready(function() {
            $('#article-bar').affix({
                offset: {
                    top: $('#article-bar').offset().top,
                    bottom: ($('#footer').outerHeight(true))
                }
            });

            var url = document.location.toString();
            if (url.match('#')) {
                var panelId = url.split('#')[1];
                $('#article-bar a[href="#' + panelId + '"]').tab('show');
                handlePanels(panelId);
            }
            
            $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                // Modify url
                window.location.hash = e.target.hash;

                var panelId = e.target.hash.split('#')[1];
                handlePanels(panelId);
            });

            // Make map full screen
            $('#map').height($(window).height() - 50);
            drawPhotosOnMap();
        });

        function handlePanels(panelId) {
            var headerHeight = $('#header').height();
            var headerTitleHeight = headerHeight + $('#title-wrapper').height();
            var scrollHeight = 0;

            if (panelId == 'article') {
                scrollHeight = headerHeight;
                $('#footer').removeClass('hidden');
            } else if (panelId == 'gallery') {
                scrollHeight = headerTitleHeight;
                $('#grid').imageGrid();
                $('#footer').removeClass('hidden');
            } else if (panelId == 'map') {
                scrollHeight = headerTitleHeight;
                $('#footer').addClass('hidden');
            }

            $("html, body").stop().animate({scrollTop: scrollHeight}, '500', 'swing', function() {
            });
        }

        function drawPhotosOnMap() {
            // 百度地图API功能
            var map = new BMap.Map("map");
            map.enableScrollWheelZoom();
            map.addControl(new BMap.MapTypeControl({anchor: BMAP_ANCHOR_TOP_LEFT}));
            map.addControl(new BMap.NavigationControl({anchor: BMAP_ANCHOR_TOP_RIGHT, type: BMAP_NAVIGATION_CONTROL_ZOOM}));
            var point = new BMap.Point(116.30962489036, 40.055884775236);
            var marker = new BMap.Marker(point);
            map.addOverlay(marker);
            map.centerAndZoom(point, 15);
{#            marker.addEventListener("click", function(){#}
{#                this.openInfoWindow(infoWindow);#}
{#                document.getElementById('imgDemo').onload = function (){#}
{#                    infoWindow.redraw();   //防止在网速较慢，图片未加载时，生成的信息框高度比图片的总高度小，导致图片部分被隐藏#}
{#                }#}
{#            });#}
            $('#demo-photo').click(function() {
                marker.openInfoWindow(infoWindow);
                //图片加载完毕重绘infowindow
                document.getElementById('imgDemo').onload = function (){
                    infoWindow.redraw();   //防止在网速较慢，图片未加载时，生成的信息框高度比图片的总高度小，导致图片部分被隐藏
                }
            });
            $('#grid img').each(function() {
                var imgInfo = $(this).attr('img-info').split('\t');
                var point = new BMap.Point(parseFloat(imgInfo[0]), imgInfo[1]);
                var marker = new BMap.Marker(point);
                var content =
                        "<h6 style='margin:0 0 5px 0;padding:0.2em 0'>" + $(this).attr('title') + "</h6>" +
                        "<img style='float:right;margin:4px' id='imgDemo' src='" + $(this).attr('src') + "' width='295' height='221' title='天安门'/>" +
                        "</div>";
                var infoWindow = new BMap.InfoWindow(content);  // 创建信息窗口对象
                map.addOverlay(marker);
                marker.addEventListener("click", function(){
                    this.openInfoWindow(infoWindow);
{#                    document.getElementById('imgDemo').onload = function (){#}
{#                        infoWindow.redraw();   //防止在网速较慢，图片未加载时，生成的信息框高度比图片的总高度小，导致图片部分被隐藏#}
{#                    }#}
                });
            });


        }
    </script>
{% endblock %}
