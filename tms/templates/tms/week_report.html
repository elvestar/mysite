{% extends 'tms/tms.html' %}

{% block content_title %}
    <a href="#">
        <i class="fa fa-file-text-o"></i>
        我的周报
    </a>
{% endblock %}

{% block content %}
    <div class="report-wrapper">
        <div class="report-content m-t-md">
            <div class="report-header">
                <div class="report-control">
                    <a class="control-arrow" href="{% url 'tms:week_report' %}?year={{ iso_year_of_prev_week }}&week={{ prev_week }}"><i class="fa fa-angle-left"></i></a>
                <span class="report-date">{{ iso_year }}年第{{ week }}周
                    {% if is_cur_week %}
                        <small>(本周)</small>
                    {% endif %}
                </span>
                    <a class="control-arrow" {% if not is_cur_week %}href="{% url 'tms:week_report' %}?year={{ iso_year_of_next_week }}&week={{ next_week }}" {% endif %}><i class="fa fa-angle-right"></i></a>
                </div>
            </div>
            <div class="report-body m-y-lg">
                <ul>
                    {% for category in report_data.categories %}
                        <li>
                            <span><strong style="color: darkred; font-size: 110%; text-decoration: underline;">{{ category.name }}</strong> [<strong style="color: darkgreen">耗时: {{ category.cost }}</strong>][<strong style="color: red">总占比: {{ category.pct }}</strong>]</span>：
                            <ul>
                                {% for project in category.projects %}
                                    <li>
                                        <div class="project-item">
                                            <a href="#project{{ project.id }}" class="collapse-header" data-toggle="collapse" aria-expanded="false" aria-controls="project{{ project.id }}">
                                                <strong>{{ project.name }}</strong> [耗时: {{ project.cost }}][占比: {{ project.pct }}]
                                                <a href="{% url 'tms:project' %}?c={{ category.name }}&p={{ project.name }}" target="_blank">
                                                    <i class="fa fa-link" style="color: #666"></i>
                                                </a>
                                            </a>
                                            <ul class="collapse {% if loop.index == 1 %} in {% endif %}" id="project{{ project.id }}">
                                                {% for thing in project.things %}
                                                    <li>{{ thing.name }} [耗时: {{ thing.cost }}]</li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="report-aside">
        </div>
    </div>



    {#    <div class="row">#}
    {#        <div class="col-md-6">#}
    {#            <div class="panel panel-default">#}
    {#                <div class="panel-heading">#}
    {#                    <h3 class="panel-title">#}
    {#                        耗时分布图#}
    {#                    </h3>#}
    {#                </div>#}
    {#                <div class="panel-body">#}
    {#                    <div id="pieNestGraph" style="width: 100%;height:400px;"></div>#}
    {#                </div>#}
    {#            </div>#}
    {#        </div>#}
    {#        <div class="col-md-6">#}
    {#            <div class="panel panel-default">#}
    {#                <div class="panel-heading">#}
    {#                    <h3 class="panel-title">#}
    {#                        全部计时项 <small>共 {{ clock_items|length }} 个</small>#}
    {#                    </h3>#}
    {#                </div>#}
    {#                <div class="panel-body" style="height: 420px; overflow: scroll">#}
    {#                    <table class="table table-condensed table-striped">#}
    {#                        <caption>#}
    {#                        </caption>#}
    {#                        <tr>#}
    {#                            <th>THING</th>#}
    {#                            <th>耗时</th>#}
    {#                            <th>起止时间</th>#}
    {#                        </tr>#}
    {#                        {% for clock_item in clock_items %}#}
    {#                            <tr>#}
    {#                                <td class="small">#}
    {#                                    {{ clock_item.thing }} <br/>#}
    {#                                    <a href="/report">#}
    {#                                        {{ clock_item.category }}#}
    {#                                    </a>#}
    {#                                    ->#}
    {#                                    <a href="/report">#}
    {#                                        {{ clock_item.project }}#}
    {#                                    </a>#}
    {#                                </td>#}
    {#                                <td>{{ clock_item.time_cost_min }}</td>#}
    {#                                <td class="small">#}
    {#                                    {{ clock_item.start_time|date:"Y-m-d H:i" }} <br/>#}
    {#                                    {{ clock_item.end_time|date:"Y-m-d H:i" }}#}
    {#                                </td>#}
    {#                            </tr>#}
    {#                        {% endfor %}#}
    {#                    </table>#}
    {#                </div>#}
    {#            </div>#}
    {#        </div>#}
    {#    </div>#}
{% endblock %}

{% block scripts %}
    {{ block.super }}
{% endblock %}
